# Code Review Plan (2025-12-06)

Scope & Approach
- Review first-party code under src/, include/, tests/, tools/, scripts/, build.*. Exclude third_party (owlnext, googletest) from detailed review; note integration risks only.
- Preserve legacy OWL/Windows conventions (2-space indent, brace placement, ALL_CAPS consts) per AGENTS.md; no formatting changes.
- Use static review (no code edits). Build/test commands noted for context only.

Code Inventory (first-party)
- Core engine: include/railcore/*.h, src/railcore/*.cpp; persistence: src/railcore/persistence, include/railcore/persistence.
- UI: src/railui/*.CPP/*.H, include/railui/*.h (stage_telemetry_cache etc.).
- CLI/validation: src/railui/cli_validate.*.
- Tools/scripts: tools/*.ps1/*.cmd/*.bat, scripts/, build.cmd/build.bat/run.cmd.
- Tests: tests/gtest/*.cpp, tests/railcore/*.cpp; coverage helpers in build/coverage generated (read-only reference).

Review Steps
1) Read meta docs: AGENTS.md, CLAUDE.md, ARCHITECTURE.md, UI_* analysis, layout visualization doc for context and constraints.
2) Core engine & persistence: review public interfaces (include/railcore), engine_stub, rcd_id/repository; trace data flow and error handling.
3) CLI & validation path: cli_validate.{h,cpp} and related UI helpers; verify argument parsing, validation coverage, edge cases.
4) UI panels/dialogs: key UI modules (LAYOUT, ROUTES, LOCOS, LOCAYARD, PLATFORM, SELECTOR, TIMETABL, etc.) focusing on state handling, memory ownership, observer use, and thread-safety.
5) Stage telemetry & caching: stage_telemetry_cache.* plus ovlpdata/handleguard/DEBUGMEMORYGUARD usage; check lifetime and guard macros.
6) Tests: map test coverage vs code paths (tests/gtest + tests/railcore). Identify missing cases; note flaky/slow risks.
7) Build/tooling: skim build.cmd, Directory.Build.props, tool scripts for reproducibility and guard settings; check STRICT/BUILD_GTEST flags alignment with docs.
8) Summarize findings by severity with file:line references, risks, and recommended actions. Capture open questions and suggested follow-ups.

Notes
- Record findings and risk rationale during review; reference this plan in final report (wrk_docs/2025.12.06 - CR - <desc>.md).
