# Outage Recovery Plan - Visual Studio Migration & Coverage Push
**Date:** 2025-11-10
**Context:** Power loss interrupted the in-flight move to VS2022/OWLNext builds and the follow-up stage-telemetry + coverage initiatives. This plan resumes that work without losing the Borland-compatible history.

## Work-In-Progress Snapshot
- **Toolchain migration:** New build.cmd, Directory.Build.props, NuGet pinning, and MSVC projects under build/msvc/ were authored but not committed; legacy root .CPP/.H files were deleted locally while their src/railui counterparts remain.
- **Docs & guidance:** CLAUDE.md now describes the VS2022 toolchain, while user-facing docs (README, repo guidelines) still mention Borland.
- **Sample data:** New regression RCD sets (Game files/*, bad_*, dup_*, ok_*) were staged for CLI/tests but are only in the working tree.
- **Stage telemetry:** Journals (2025.11.05) note new caching APIs inside TLayout/TTimetable; controller adapters and tests still pending.
- **Coverage program:** Reports + implementation plan (2025.11.07) exist, but Stage 0 tasks (instrumentation, CI wiring) have not started.
- **Const fix:** TTimetable::GetStatus was made const but needs rebuild + regression verification.

## Action Plan
1. **Stabilize the repo after outage**
   - Capture git status baseline; archive current working tree.
   - Decide whether to keep deleting root legacy files or reintroduce them until MSVC build fully replaces Borland (railc.mak, build.bat).
   - Add transient artifacts (build/msvc/Debug, build/msvc/intermediate, nul) to .gitignore and clean the workspace.

2. **Finish MSVC toolchain migration**
   - Review build/msvc/*.vcxproj for complete source/resource coverage (resources, help, RCD assets, third_party libs).
   - Wire RailControl.sln + helper scripts into CI (.github/workflows/msvc.yml) once verified locally.
   - Run build.cmd Debug STRICT=1 BUILD_GTEST=1 and confirm railc.exe, RailCore.lib, RailCoreTests.exe, and GoogleTests all pass.
   - Update packaging logic so railc.exe/RAILC.HLP copy to repo root automatically; remove obsolete Borland-specific BAT/MAK if replacing them.

3. **Align documentation & onboarding**
   - Update README, AGENTS.md, and repo guidelines to match the MSVC workflow described in CLAUDE.md.
   - Note coexistence (or retirement) of Borland tooling with explicit dates, to avoid confusion for agents following older instructions.

4. **Complete stage telemetry feature**
   - Finish adapter path from RailCore: feed StageTelemetryCache via controller ticks before HandleTimeChange runs.
   - Add formatter helpers + unit tests (pure functions) so Arrivals/Departures rendering is testable.
   - Add manual smoke checklist: enable debug hook, verify stage strings, ensure fallback still works when telemetry absent.

5. **Kick off coverage Stage 0 (per 2025.11.07 plan)**
   - Instrument MSVC builds with OpenCppCoverage via tools/coverage.cmd and capture baseline XML/HTML.
   - Extend build.cmd/CI to publish coverage artifacts; add README badge after baseline accepted.
   - Break down Stage 1 backlog (RailCore enhancement) into issues so work can start immediately after instrumentation.

6. **Validate new RCD fixtures & CLI tests**
   - Move Game files/*, bad_*, dup_*, ok_* into a versioned data/ folder or keep current layout but document usage.
   - Ensure CLI/GoogleTest suites consume the new files (update tests/gtest/cli_validate_tests.cpp etc.).
   - Re-run railc.exe --rcd-validate across all fixtures; stash logs under cli_logs/.

7. **Regression & sign-off**
   - After completing steps 1-6, rebuild Release, launch GUI (railc.exe), load key layouts, and spot-check help (F1).
   - Document results + remaining gaps in a follow-up journal entry before merging.

## Verification Checklist
- [ ] build.cmd Debug STRICT=1 BUILD_GTEST=1 succeeds.
- [ ] build.cmd Release outputs railc.exe + RAILC.HLP to repo root.
- [ ] Coverage report artifacts (Debug) attached to CI run.
- [ ] Stage telemetry UI manually validated with/without controller-fed data.
- [ ] CLI validation logs archived for all new .RCD fixtures.
