# Post-outage continuation plan

## 1. Re-establish a clean baseline (Today)
- Run `build.bat Debug STRICT=1` to confirm RailControl, RailCore, and RailCoreTests still build/run after the abrupt shutdown; capture the refreshed logs in `build_output_latest.txt` for reference.
- Re-run the CLI smoke commands documented in README (`FAST.RCD`, `bad_tt_arrsel.rcd`, `Game files\*.RCD`) to verify `RunRcdValidationCli` did not regress; stash their console + `RCD_CLI_LOG` output for the war room.
- Kick `BUILD_GTEST=1 build.bat Debug` once to ensure NuGet restore still succeeds post-power cut; if it flaps, document the failure signature for CI triage rather than papering over it locally.

## 2. Finish the CLI validation feature (This week)
- Factor the console-free "single path" helper promised in the implementation plan so we can unit-test failure paths without spawning `railc.exe` (see `docs/2025-10-22_rcd_cli_validation_plan.md`). Wire that helper into the existing GoogleTests instead of end-to-end process runs.
- Wrap `RunRcdValidationCli` in a try/catch so that unexpected exceptions return exit code `3` and emit `Internal error: ...`, matching the spec.
- Harden wildcard expansion: treat directories discovered via patterns the same way as explicit dirs (currently `ExpandWildcard` filters directories out). Add tests covering `--rcd-validate "Game files\bad*"` cases to ensure deterministic ordering still holds.
- Decide whether mirrored logging should be opt-in via CLI flag or env var only; document whichever path we keep inside README and `docs/rcd_cli_*`.

## 3. Surface new scheduling metadata in the UI (Next 2-3 days)
- Consume the new `DomainEventId::TrainDeparted`, `stage/stageIndex`, and `stagePrimary/Secondary` fields emitted by `engine_stub.cpp` so Arrivals/Departures panes can visualize live progression. Start with a lightweight status string or icon in `src/railui/ARRIVALS.CPP` and `DEPARTUR.CPP` that reflects the current stage.
- Teach `TMainWindow::HandleChildResize` to coalesce resize storms (debounce) so continual timetable updates do not thrash the optimized layout mode.
- Extend the help file / README with a short note on the richer telemetry so operators know what the new signals mean.

## 4. Parser + data follow-ups (Next week)
- Now that `rcd_repository.cpp` tolerates duplicate LOCOS/TIMETABLE entries and repairs ROUTES whitespace, add regression fixtures under `Game files/bad_*.rcd` for every new branch (e.g., missing stage tokens, selector mismatches) so the CLI and GTests keep covering them.
- Persist the computed layout SHA-256 (`desc.id`) somewhere user-visible (maybe a hidden column in the diagnostics dialog or a `railc --rcd-validate --print-id` follow-up flag) so support can quickly fingerprint layouts.
- Document the relaxed GENERAL parsing (comma vs equals) in the RCD format guide under `docs/2025.10.17 - RCD file format guide.md`.

## 5. CI + tooling hygiene (Parallel)
- Update `.github/workflows/msvc.yml` so the new CLI sanity steps run under a matrix that covers both Debug and Release binaries (today only Debug is exercised).
- Promote the soft coverage capture for GoogleTests to a hard gate once coverage noise is understood; ensure `tools/coverage_merge_gate.ps1` logs merged deltas even on failure for faster debugging.
- Trim `build.cmd`: default to Release again, accept `CONFIG=` plus fallback to Debug only when unspecified, and emit a final summary of which binaries/tests ran to aid future outage triage.
