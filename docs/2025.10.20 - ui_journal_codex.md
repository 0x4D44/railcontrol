# Rail Control UI Investigation — 2025-10-20

## Session Start
- Reviewed high-level instructions and repository layout.
- Confirmed task: address oversized UI content (About, Platforms, Departures, Arrivals) and ensure Locoyard window appears.
- Skimmed relevant source files (`ABOUT.CPP`, `ARRIVALS.CPP`, `DEPARTUR.CPP`, `PLATFORM.CPP`, `LOCOYARD.CPP`) to understand existing layout logic.
- Noted hard-coded pixel constants (e.g., 17px line spacing) likely responsible for overflow under newer font metrics.
- Observed bitmap positions in `ABOUT.CPP` exceeding dialog resource bounds — candidate root cause for clipped graphics.
- Initial hypothesis for Locoyard issue: runtime gating via `LocoyardEnabled` flag or window creation failure; need deeper inspection.

## Deeper Analysis
- Traced arrival/departure layout code: both rely on fixed 17px row spacing and 16px highlight rectangles, making the client area too short when fonts scale; will need to derive row metrics from `TEXTMETRIC`.
- Platform window uses the same spacing constants but drives up to 49 entries; height must expand with the number of active platforms.
- Confirmed `DrawRaisedPanel` background stretches to client rect, so resizing windows to fit content should suffice once row spacing adapts to the active font.
- Reviewed Locoyard creation flow in `RAILC.CPP`; window only opens if `LocoyardEnabled` is true. Layout loader toggles this based on `[LOCOYARD]` section (`Disabled` keyword). Need to ensure menu state reflects this and consider dynamic sizing similar to other panes.

## Implementation Progress
- Introduced reusable content tracking in Arrivals/Departures/Platforms/Locoyard windows: each now samples font metrics, computes row spacing, and resizes via `AdjustWindowRectEx` when rendered content exceeds the current client area.
- Replaced hard-coded 17px increments with metric-driven spacing; added `MeasureStringWidth` helpers to capture widest drawn text and avoid truncated columns.
- Modernised About box: dialog resource widened/tallied to cover bitmap footprint, and `EvPaint` now positions artwork based on actual bitmap dimensions plus client size.
- Locoyard updates: dynamic layout logic mirrors other list panes, and new clamping keeps the window on-screen even when persisted coordinates drift outside the virtual desktop.

## Pending Verification
- Need to rely on static reasoning (no Borland build available) but ensured all new sizing helpers guard against null DCs and preserve previous behaviour when metrics fail.
- Added informational prompt when layouts disable the Locoyard so the menu selection provides feedback instead of silently failing.
