# Rail Control MSVC Smoke Test (17 Oct 2025)

## Preconditions
- Visual Studio 2022 toolchain installed and uild_msvc.bat able to produce Debug and Release artefacts.
- OWLNext libraries rebuilt via uild/msvc/build_owlnext_msvc.bat.
- Sample layout files (FAST.RCD, KINGSX.RCD, QUEENST.RCD, WAVERLY.RCD) present in the repository root.
- Windows audio enabled (for PlaySound validation).

## Debug Build Checklist
1. Run uild_msvc.bat with no arguments and confirm uild/msvc/Debug/railc_msvc.exe is updated.
2. Launch the Debug executable and verify the startup splash and main window menu render with no GDI artefacts.
3. Open FAST.RCD via File -> Open and ensure the layout paints correctly (sections, selectors, platforms).
4. Cycle selectors (number keys 1-8) and confirm the highlight updates without tearing or lag.
5. Trigger arrival/departure windows (Arrivals/Departures menu) and validate delay text formatting matches expectations.
6. Press F1 and ensure the WinHelp viewer opens to the Rail Control overview.
7. Execute an action that plays sound (train arrival) and confirm the `BEEP` wave plays; if the system audio device is missing, verify the fallback `MessageBeep` occurs once with no error dialogs.

## Release Build Checklist
1. Run uild_msvc.bat Release and confirm uild/msvc/Release/railc_msvc.exe timestamps update.
2. Launch the Release executable and repeat steps 3-7 from the Debug checklist, noting any behavioural differences (especially rounding/formatting) and that audio behaviour matches the Debug run.
3. Monitor Task Manager for the Release build to ensure CPU usage stabilises below 5% while idle.


## Memory Guard Checklist
1. Run `tools\enable_memory_guards.bat status` after building to confirm PageHeap/Application Verifier are enabled for `railc_msvc.exe` (expect `Enabled` and `Verified` entries).
2. Launch the Debug build with `[Diagnostics] EnableMemoryGuards=1` (default) and exercise arrivals, departures, platform, and yard overlays; exit the app cleanly.
3. Inspect `%LOCALAPPDATA%\RailControl\Logs` and verify `memory_guard.log` contains startup/shutdown entries only (no `anomaly` or `exception` categories).
4. When reproducing a guard failure, confirm a matching minidump appears under `%LOCALAPPDATA%\RailControl\Dumps` and capture the timestamp.
5. Archive guard artefacts with `pwsh -File tools\collect_minidump.ps1` and attach the resulting zip to the smoke report if anomalies were observed.

## Regression Sweep
- Load each remaining sample layout (KINGSX.RCD, QUEENST.RCD, WAVERLY.RCD) and repeat selector/arrival interactions.
- Toggle sound on/off within configuration to confirm the profile persistence routine still writes expected values.
- Close the application from the toolbar quit button and via Alt+F4, confirming configuration writes succeed (no error message boxes).

## Sign-off
- Record pass/fail for each checklist item in the release log.
- File issues for any deviations before promoting builds or enabling mandatory CI for MSVC.
