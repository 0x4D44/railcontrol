# Rail Control Modern Toolchain Implementation Plan

## 1. Summary
This roadmap decomposes the migration strategy into staged execution with clear owners, dependencies, and deliverables.

## 2. Stage Overview
| Stage | Target Duration | Primary Owners | High-Level Deliverables |
|-------|-----------------|----------------|-------------------------|
| 0. Preparation | 1-2 weeks | Build Engineering | Environment readiness, CI skeleton, baseline artifact plan |
| 1. Library & Infrastructure | 2-3 weeks | Build Engineering + Tooling | OWLNext v7 static libs, MSVC project scaffolding |
| 2. Codebase Porting | 4-6 weeks | Core Dev Team | Compiling MSVC build, compatibility fixes, documentation |
| 3. Validation & Parity | 2-3 weeks | QA + Dev | Smoke/regression evidence, performance metrics |
| 4. Cutover & Cleanup | 1-2 weeks | Product + Build | Updated docs, CI enforcement, sunset decision |

_Durations assume 1-2 engineers with partial allocation; adjust as staffing changes._

## 3. Stage Details

### Stage 0 - Preparation
- **Entry Criteria**: Migration plan approved; build hardware available.
- **Tasks**
  - Capture baseline Borland build (binary, PDB, map file) for archive in `artifacts/legacy/2025-10`. (**Pending**)
  - Inventory INI defaults, help assets, resource files; document in `docs/baseline_assets.md`. (**In progress**)
  - Install Visual Studio 2022 + Windows SDK + GitHub CLI on dev hosts; record versions. (**Done - VS Community 2022 17.14 installed 17 Oct 2025**)
  - Prototype CI skeleton (GitHub Actions) for BC5 placeholder + MSVC pipeline. (**Done - `.github/workflows/msvc.yml`**)
- **Deliverables**: Environment readiness report, updated README prerequisites, CI placeholder workflow.
- **Exit Criteria**: Tooling available; CI skeleton merged; baseline capture plan logged.

### Stage 1 - Library & Infrastructure
- **Dependencies**: Stage 0 complete; OWLNext sources unpacked in `third_party/owlnext/`.
- **Tasks**
    - Build OWLNext 7.0.19 Win32 static libraries with COMPAT=5 using `build\msvc\build_owlnext_msvc.bat`; archive outputs in `third_party/owlnext/lib`. (**Done**)
    - Draft MSVC solution (`build/msvc/RailControl.sln`) referencing new libraries and legacy sources/resources. (**Done – initial MSVC build now fails in Stage 2 due to obsolete OWL compatibility macros**) 
    - Configure resource compilation/output directories to mirror Borland layout. (**Done – baked into project settings**)
    - Create top-level automation (`build_msvc.bat`) and update docs with workflow. (**Done – wrapper sets up MSVC environment and invokes MSBuild**)
    - Extend CI workflow to invoke MSVC build (initially allowed to fail until Stage 2). (**Done – `.github/workflows/msvc.yml` builds OWLNext and runs `build_msvc.bat Debug` with `continue-on-error` while porting)**
- **Deliverables**: OWLNext libraries, build scripts, initial MSVC project scaffolding (solution, project, filters).
- **Exit Criteria**: MSVC project links against placeholder/stub app; CI step runs successfully.

### Stage 2 - Codebase Porting
- **Dependencies**: Stage 1 MSVC project files and OWLNext libs available.
- **Tasks**
    - Resolve compiler errors (e.g., OWLNext v7 rejecting `OWL1_COMPAT`/`OWL2_COMPAT` flags), track remediation issues per module.
  - Replace Borland-specific pragmas/macros with MSVC-friendly alternatives.
  - Update legacy headers (`strstrea.h`, etc.) to standard equivalents.
  - Implement conditional fallbacks for CTL3D/OLE quirks.
  - Link against required Win32 system libraries; address entry point differences.
  - Add optional diagnostic instrumentation (timer cadence, etc.).
- **Deliverables**: Successful MSVC build (`railc_msvc.exe`), `docs/porting_notes.md`, source updates.
- **Exit Criteria**: Application runs to main window; compiler warnings triaged or waived.

### Stage 3 - Validation & Parity
- **Dependencies**: MSVC binary available.
- **Tasks**
  - Execute smoke-test matrix with sample `.RCD` files; log in `QA/validation_report.md`.
  - Capture performance benchmarks (timer accuracy, CPU usage).
  - Compare UI output against Borland baseline (screenshots, notes).
  - Triage parity issues (functional vs. cosmetic) in tracker; coordinate fixes.
  - Run MSVC Debug CRT to detect runtime assertions/leaks.
- **Deliverables**: Regression report, parity issue log, performance metrics.
- **Exit Criteria**: No high/critical parity issues open; performance within +/-5% of baseline.

### Stage 4 - Cutover & Cleanup
- **Dependencies**: Stage 3 sign-off; residual issues tracked.
- **Tasks**
  - Update README, architecture, and HLD docs with MSVC workflow.
  - Promote MSVC CI job to required status; demote Borland build to best-effort.
  - Draft migration retrospective (wins, blockers, follow-ups).
  - Announce sunset timeline for Borland toolchain; archive legacy scripts later.
  - Package MSVC deliverables (zip/MSIX) for distribution.
- **Deliverables**: Documentation updates, release artifact, sunset announcement, retrospective.
- **Exit Criteria**: MSVC workflow adopted as default; legacy toolchain scheduled for retirement.

## 4. Cross-Stage Governance
- Weekly 30-minute sync (Build, Core Dev, QA) to review progress and risks.
- Maintain `migration-risk` issue label; review at each stage exit.
- Record key decisions in `docs/decisions/YYYY-MM-DD-*.md`.
- CI policy: stage not considered complete until corresponding pipelines pass.

## 5. Resource Requirements
- **Personnel**: 1 build engineer (stages 0-1 & 4), 1-2 core developers (stage 2), 1 QA engineer (stage 3).
- **Infrastructure**: Windows 11 build host with VS 2022 (200 GB free), optional legacy VM with BC5.

## 6. Milestones (Indicative)
| Milestone | Target (from kick-off) | Owner |
|-----------|-----------------------|-------|
| Stage 0 review | +2 weeks | Build Lead |
| Stage 1 project files merged | +5 weeks | Build Lead |
| First MSVC executable | +9 weeks | Core Dev Lead |
| Parity sign-off | +12 weeks | QA Lead |
| MSVC cutover announcement | +14 weeks | Product Owner |

_Dates subject to revision as scope/availability evolves._
